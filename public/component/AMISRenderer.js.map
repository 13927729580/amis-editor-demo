{"version":3,"sources":["/component/AMISRenderer.tsx"],"names":[],"mappings":"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","file":"AMISRenderer.js","sourcesContent":["import React from 'react';\nimport {RouteComponentProps, withRouter} from 'react-router';\nimport {inject, observer} from 'mobx-react';\nimport {getEnv} from 'mobx-state-tree';\nimport {IMainStore} from '../store';\nimport qs from 'qs';\nimport {render, utils, filter} from 'amis';\n\nexport function schema2component(schema: any, transform?: Function, session: string = 'page') {\n    interface SchemaRendererProps extends RouteComponentProps<{}> {\n        store: IMainStore;\n        [propName: string]: any;\n    }\n\n    @inject('store')\n    @observer\n    class SchemaRenderer extends React.Component<SchemaRendererProps> {\n        static displayName = 'SchemaRenderer';\n        env: any;\n\n        getEnv() {\n            if (this.env) {\n                return this.env;\n            }\n\n            const props = this.props;\n            const store = props.store;\n            const rootEnv = getEnv(store);\n\n            const normalizeLink = (to: string, preserveHash?: boolean) => {\n                if (/^\\/api\\//.test(to)) {\n                    return to;\n                }\n\n                to = to || '';\n                const history = this.props.history;\n                const location = history.location;\n                const currentQuery = qs.parse(location.search.substring(1));\n                to = filter(to.replace(/\\$\\$/g, qs.stringify(currentQuery)), currentQuery);\n\n                if (to && to[0] === '#') {\n                    to = location.pathname + location.search + to;\n                } else if (to && to[0] === '?') {\n                    to = location.pathname + to;\n                }\n\n                const idx = to.indexOf('?');\n                const idx2 = to.indexOf('#');\n                let pathname = ~idx ? to.substring(0, idx) : ~idx2 ? to.substring(0, idx2) : to;\n                let search = ~idx ? to.substring(idx, ~idx2 ? idx2 : undefined) : '';\n                let hash = ~idx2 ? to.substring(idx2) : preserveHash ? location.hash : '';\n\n                if (!pathname) {\n                    pathname = location.pathname;\n                } else if (pathname[0] != '/' && !/^\\w+\\:/.test(pathname)) {\n                    let relativeBase = location.pathname;\n                    const paths = relativeBase.split('/');\n                    paths.pop();\n                    let m;\n                    while ((m = /^\\.\\.?\\//.exec(pathname))) {\n                        if (m[0] === '../') {\n                            paths.pop();\n                        }\n                        pathname = pathname.substring(m[0].length);\n                    }\n                    pathname = paths.concat(pathname).join('/');\n                }\n\n                return pathname + search + hash;\n            };\n\n            const isCurrentUrl = (to: string) => {\n                const history = this.props.history;\n                const link = normalizeLink(to);\n                const location = history.location;\n                let pathname = link;\n                let search = '';\n                const idx = link.indexOf('?');\n                if (~idx) {\n                    pathname = link.substring(0, idx);\n                    search = link.substring(idx);\n                }\n\n                if (search) {\n                    if (pathname !== location.pathname || !location.search) {\n                        return false;\n                    }\n                    const currentQuery = qs.parse(location.search.substring(1));\n                    const query = qs.parse(search.substring(1));\n\n                    return Object.keys(query).every(key => query[key] === currentQuery[key]);\n                } else if (pathname === location.pathname) {\n                    return true;\n                }\n\n                return false;\n            };\n\n            return (this.env = {\n                ...rootEnv,\n                session,\n                isCurrentUrl,\n                updateLocation:\n                    props.updateLocation ||\n                    ((location: string, replace: boolean) => {\n                        const history = this.props.history;\n                        if (location === 'goBack') {\n                            return history.goBack();\n                        } else if (/^https?\\:\\/\\//.test(location)) {\n                            return (window.location.href = location);\n                        }\n\n                        history[replace ? 'replace' : 'push'](normalizeLink(location, replace));\n                    }),\n                jumpTo:\n                    props.jumpTo ||\n                    ((to: string, action?: any) => {\n                        const history = this.props.history;\n                        if (to === 'goBack') {\n                            return history.goBack();\n                        }\n\n                        to = normalizeLink(to);\n\n                        if (isCurrentUrl(to)) {\n                            return;\n                        }\n\n                        if (action && action.actionType === 'url') {\n                            action.blank === false ? (window.location.href = to) : window.open(to, '_blank');\n                            return;\n                        } else if (action && action.blank) {\n                            window.open(to, '_blank');\n                            return;\n                        }\n\n                        if (/^https?:\\/\\//.test(to)) {\n                            window.location.href = to;\n                        } else {\n                            history.push(to);\n                        }\n                    }),\n                affixOffsetTop: props.embedMode ? 0 : 50,\n                theme: store.theme\n            });\n        }\n\n        render() {\n            const {\n                router,\n                match,\n                location,\n                history,\n                store,\n                schema: schemaProp,\n                jumpTo,\n                updateLocation,\n                embedMode,\n                ...rest\n            } = this.props;\n            const finalSchema = schemaProp || schema;\n            let body: React.ReactNode;\n\n            finalSchema.type || (finalSchema.type = 'page');\n\n            body = render(\n                finalSchema,\n                {\n                    location,\n                    data: utils.createObject({\n                        ...match.params,\n                        amisStore: store,\n                        pathname: location.pathname,\n                        params: match.params\n                    }),\n                    ...rest,\n                    propsTransform: transform\n                },\n                this.getEnv()\n            );\n\n            return <>{body}</>;\n        }\n    }\n\n    return withRouter(SchemaRenderer);\n}\n\nexport default schema2component({type: 'page', body: 'It works'});\n"]}